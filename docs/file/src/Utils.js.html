<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Utils.js | backbone-es6 API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/typhonjs/backbone-es6/" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Backbone.js~Backbone.html">Backbone</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Collection.js~Collection.html">Collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Debug.js~Debug.html">Debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Events.js~Events.html">Events</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/History.js~History.html">History</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Router.js~Router.html">Router</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Utils.js~Utils.html">Utils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/View.js~View.html">View</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extend">extend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sync">sync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BackboneProxy">BackboneProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-collection">collection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-model">model</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Utils.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

import _             from &apos;underscore&apos;;
import BackboneProxy from &apos;./BackboneProxy.js&apos;;

// Private / internal methods ---------------------------------------------------------------------------------------

/**
 * Creates an optimized function that dispatches to an associated Underscore function.
 *
 * @param {number}   length      - Length of variables for given Underscore method to dispatch.
 * @param {string}   method      - Function name of Underscore to invoke.
 * @param {string}   attribute   - Attribute to associate with the Underscore function invoked.
 * @returns {Function}
 */
const s_ADD_METHOD = (length, method, attribute) =&gt;
{
   switch (length)
   {
      case 1:
         return function()
         {
            return _[method](this[attribute]);
         };
      case 2:
         return function(value)
         {
            return _[method](this[attribute], value);
         };
      case 3:
         return function(iteratee, context)
         {
            return _[method](this[attribute], s_CB(iteratee), context);
         };
      case 4:
         return function(iteratee, defaultVal, context)
         {
            return _[method](this[attribute], s_CB(iteratee), defaultVal, context);
         };
      default:
         return function()
         {
            const args = Array.prototype.slice.call(arguments);
            args.unshift(this[attribute]);
            return _[method](...args);
         };
   }
};

/**
 * Support `collection.sortBy(&apos;attr&apos;)` and `collection.findWhere({id: 1})`.
 *
 * @param {*} iteratee  -
 * @returns {*}
 */
const s_CB = (iteratee) =&gt;
{
   if (_.isFunction(iteratee)) { return iteratee; }
   if (_.isObject(iteratee) &amp;&amp; !Utils.isModel(iteratee)) { return s_MODEL_MATCHER(iteratee); }
   if (_.isString(iteratee))
   {
      return function(model)
      {
         return model.get(iteratee);
      };
   }
   return iteratee;
};

/**
 * Creates a matching function against `attrs`.
 *
 * @param {*} attrs -
 * @returns {Function}
 */
const s_MODEL_MATCHER = (attrs) =&gt;
{
   const matcher = _.matches(attrs);
   return (model) =&gt;
   {
      return matcher(model.attributes);
   };
};

/**
 * Provides static utility functions.
 * --------
 *
 * Proxy Backbone class methods to Underscore functions, wrapping the model&apos;s `attributes` object or collection&apos;s
 * `models` array behind the scenes.
 *
 * `Function#apply` can be slow so we use the method&apos;s arg count, if we know it.
 *
 * @example
 * collection.filter(function(model) { return model.get(&apos;age&apos;) &gt; 10 });
 * collection.each(this.addView);
 */
export default class Utils
{
   /**
    * Adds Underscore methods if they exist from keys of the `methods` hash to `Class` running against the variable
    * defined by `attribute`
    *
    * @param {Class}    Class       -  Class to add Underscore methods to.
    * @param {object}   methods     -  Hash with keys as method names and values as argument length.
    * @param {string}   attribute   -  The variable to run Underscore methods against. Often &quot;attributes&quot;
    */
   static addUnderscoreMethods(Class, methods, attribute)
   {
      _.each(methods, (length, method) =&gt;
      {
         if (_[method]) { Class.prototype[method] = s_ADD_METHOD(length, method, attribute); }
      });
   }

   /**
    * Method for checking whether an unknown variable is an instance of `Backbone.Model`.
    *
    * @param {*}  unknown - Variable to test.
    * @returns {boolean}
    */
   static isModel(unknown)
   {
      return unknown instanceof BackboneProxy.backbone.Model;
   }

   /**
    * Method for checking whether a variable is undefined or null.
    *
    * @param {*}  unknown - Variable to test.
    * @returns {boolean}
    */
   static isNullOrUndef(unknown)
   {
      return unknown === null || typeof unknown === &apos;undefined&apos;;
   }

   /**
    * Throw an error when a URL is needed, and none is supplied.
    */
   static urlError()
   {
      throw new Error(&apos;A &quot;url&quot; property or function must be specified&apos;);
   }

   /**
    * Wrap an optional error callback with a fallback error event.
    *
    * @param {Model|Collection}  model    - Model or Collection target to construct and error callback against.
    * @param {object}            options  - Options hash to store error callback inside.
    */
   static wrapError(model, options)
   {
      const error = options.error;
      options.error = (resp) =&gt;
      {
         if (error) { error.call(options.context, model, resp, options); }
         model.trigger(&apos;error&apos;, model, resp, options);
      };
   }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.3)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
